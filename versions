#!/bin/zsh
###########################################
# Module Versions Checker: Compares locally installed versions with the remote (recent) version info
# by Soomin K.
###########################################
# ~/z/dev/logo
# ~/z/dev/update
C_R='\e[0;31m'
C_G='\e[0;32m'
C_B='\e[0;34m'
C_Y='\e[0;33m'
C_N='\e[0m'
# Following two variables will contain the version info and will be compared in showV()
# -------------------------------------------------
# VL: Version Local (locally installed)
# VR: Version Remote (from remote server)
# =================================================
# Set Module Info
# -------------------------------------------------
# argument $1: module name
# argument $2: L - local, R - remote, v - prefix to compare
# argument $3: remote module name (when it's different from the local)
setLR ()
{
  if [[ $1 == *"L"* ]]; then  # Local version info
    if [[ ! -z `command -v $2` ]]; then  # command exists
      VL=`$2 --version`
    else
      VL="${C_R}$2${C_G} NOT installed!${C_N}"
    fi
  else
    VL=""
  fi
  if [[ $1 == *"R"* ]]; then  # Remote version info
    if [ -z $3 ]; then
      VR=`npm show $2 version`
    else
      VR=`npm show $3 version`
    fi
  else
    VR=""
  fi
}
# =================================================
# Show Versions
# -------------------------------------------------
# argument $1: title with emoji
# argument $2: additional info
showV ()
{
  printf "${C_Y}$1${C_G}: "

  if [ -z "${VL}" ]; then    # If null: No installed version check, show shiny emoji before version info
    printf "${C_G}âœ¨${VR}"
  else
    printf "${C_N}${VL}"
    if [ -z "${VR}" ]; then  # No remote version check
      printf "âš¡ï¸"
    else
      if [[ "${VL}" == *"${VR}"* ]]; then  # latest ver contained in installed?
        printf "âœ¨"
      else
        printf "âš ï¸  ${C_G}${VR}${C_R}ğŸŒˆ"  # older or newer version installed
      fi
    fi
  fi

  if [ -z $2 ]; then   # No additional info provided
    print "${C_N}"
  else
    print " ${C_B}$2${C_N}"
  fi
}
# =================================================
# Header - show color scheme
HIST=~/z/update-hist.txt
if [ -f $HIST ]; then
  UD_Last=`tail -n 1 $HIST`  # print last one line
else
  UD_Last="${C_R}No Update Record${C_Y} -"
fi
print "${C_G}â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” ${C_Y}${UD_Last} Last Update"
print "${C_G}â”‚ ${C_Y}Versions${C_G} â”‚ ${C_N}Installed${C_G} â”‚ Latestâœ¨ â”‚ `date +'%T %m/%d/%Y'` Current"
print "${C_G}â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
# =================================================
# Main -- Since it takes time to run each step, show immediately each result
setLR LR node node@lts
showV "ğŸ node    " "${C_R}`npm show node@latest version`ğŸŒˆ ${C_B}# nvm ls"
# -------------------------------------------------
setLR LR ts-node
showV "ğŸ‹ ts-node " "TypeScript execution and REPL for node.js"
# -------------------------------------------------
setLR LR npm
showV "ğŸ npm     " "[`npm bin -g`]"
# -------------------------------------------------
setLR LR yarn
showV "ğŸ§µ yarn    " "[`yarn global bin`]"
# -------------------------------------------------
#setLR LR webpack
#showV "ğŸ“¦ webpack " "@next:${C_R}`npm show webpack@next version`"
# -------------------------------------------------
setLR LR electron
showV "ğŸ’¡ electron"
# -------------------------------------------------
setLR LR create-react-app
showV "ğŸ¥ CRA     " "# create-react-app"
# -------------------------------------------------
setLR R react
showV "ğŸ™ react   "
# -------------------------------------------------
setLR R react-scripts
showV "ğŸ£ scripts " "# react-scripts"
# -------------------------------------------------
setLR R react-redux
showV "ğŸ¤ redux   " "# react-redux"
# -------------------------------------------------
setLR R react-native
showV "ğŸ“± r-native" "# react-native"
# -------------------------------------------------
setLR R webpack
showV "ğŸ›  webpack "
# -------------------------------------------------
setLR R rxjs
showV "ğŸ¡ RxJS    "
# -------------------------------------------------
setLR R babylonjs
showV "ğŸ§¬ Babylon " "# babylonjs"
# -------------------------------------------------
setLR LR babel babel-cli
showV "ğŸŒ® babel   " "# babel-cli"
# -------------------------------------------------
setLR LR eslint
showV "ğŸ¬ eslint  "
# -------------------------------------------------
setLR LR tsc typescript
showV "ğŸ­ tsc     " "# typescript"
# -------------------------------------------------
setLR LR sass
showV "ğŸ’ sass    " "# yarn global add sass"
# -------------------------------------------------
setLR LR gatsby gatsby-cli
showV "ğŸ’‹ gatsby  " "# yarn global add gatsby gatsby-cli"
# -------------------------------------------------
setLR L ruby
showV "ğŸ”® ruby    "
# -------------------------------------------------
setLR L python
showV "ğŸ python  "
# -------------------------------------------------
setLR L pip3
showV "ğŸ¢ pip     " "# pip check"
# -------------------------------------------------
setLR L rustup
showV "ğŸ’ rustup  " "# rustup show"
# -------------------------------------------------
setLR L rustc
showV "âš™ï¸  rustc   "
# -------------------------------------------------
setLR L cargo
showV "ğŸ“¦ cargo   "
# -------------------------------------------------
VL=`go version`
showV "ğŸ‘» go      " "# https://golang.org/dl/"
# -------------------------------------------------
setLR L bazel
showV "ğŸ¤– bazel   " "# brew info bazel"
# -------------------------------------------------
VL=``
showV "ğŸ¯ dart    " "# brew upgrade dart"
dart --version
# -------------------------------------------------
setLR L flutter
showV "ğŸ flutter " "# flutter upgrade"
# -------------------------------------------------
VL=`xcodebuild -version`
showV "ğŸ›   xcode   " "# xcodebuild"
# -------------------------------------------------
setLR L swift
showV "ğŸ¦ swift   "
# -------------------------------------------------
VL=`kotlin -version`
showV "ğŸ¦‹ kotlin  " "# brew install kotlin"
# -------------------------------------------------
setLR L aws
showV "ğŸ‘¾ aws CLI " "# brew install awscli; aws ec2 describe-instances; pip install -U aws-shell"
# -------------------------------------------------
setLR L sam
showV "ğŸ˜º sam CLI " "# brew tap aws/tap; brew upgrade aws-sam-cli (Serverless Application Model)"
# -------------------------------------------------
setLR L gcloud
showV "ğŸŒ©  GCP CLI " "# gcloud components update"
# -------------------------------------------------
setLR LR clasp @google/clasp
showV "ğŸª clasp   " "# yarn global add @google/clasp (CL Apps Script)"
# -------------------------------------------------
setLR LR firebase firebase-tools
showV "ğŸ”¥ firebase" "# yarn global add firebase-tools"
# -------------------------------------------------
setLR L docker
showV "ğŸ³ docker  " "# https://hub.docker.com/"
# -------------------------------------------------
VL=`kubectl version --client`
showV "â›µ k8s     " "# kubernetes; brew install kubectl"
# -------------------------------------------------
VL=''
showV "â˜•ï¸ java    "
java -version
# -------------------------------------------------
VL=`python -m site --user-site`
print "${C_Y}Python -m site --user-site: ${C_G}${VL}${C_N}"
python -m pip list | rg tensorflow
# End
